#                       –ü–∞—Ä—Å–µ—Ä —Ü–∏–∞–Ω (cian parser)


–î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –ø–∞—Ä—Å–µ—Ä–∞ –º—ã —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º 4 –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:
üì¶ 1. requests - –ü—Ä–æ—Å—Ç–æ, –±—ã—Å—Ç—Ä–æ –∏ —É–¥–æ–±–Ω–æ —Å–∫–∞—á–∏–≤–∞–µ—Ç HTML-—Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å —Å–∞–π—Ç–æ–≤.
```python
import requests

response = requests.get("https://example.com")
html = response.text
```
üîß –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: httpx –∏–ª–∏ aiohttp (–µ—Å–ª–∏ —Ö–æ—á–µ—à—å –¥–µ–ª–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)

üçú 2. beautifulsoup4 - –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ HTML. –û—á–µ–Ω—å —É–¥–æ–±–Ω–∞—è: –º–æ–∂–Ω–æ –∏—Å–∫–∞—Ç—å –ø–æ —Ç–µ–≥–∞–º, –∫–ª–∞—Å—Å–∞–º, —Å—Ç—Ä—É–∫—Ç—É—Ä–µ.
```Python
from bs4 import BeautifulSoup

soup = BeautifulSoup(html, "lxml")
title = soup.find("h1").text
```

üß† 3. lxml - –¥–≤–∏–∂–æ–∫ (parser), –∫–æ—Ç–æ—Ä—ã–π BS4 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ‚Äú–ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º‚Äù, —á—Ç–æ–±—ã –±—ã—Å—Ç—Ä–æ –∏ –Ω–∞–¥—ë–∂–Ω–æ —Ä–∞–∑–±–∏—Ä–∞—Ç—å HTML.

üïµÔ∏è‚Äç‚ôÇÔ∏è 4. fake_useragent -–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–µ User-Agent –∑–∞–≥–æ–ª–æ–≤–∫–∏ ‚Äî –∫–∞–∫ –±—É–¥—Ç–æ —Ç—ã —Ç–æ —Å Chrome, —Ç–æ —Å Safari, —Ç–æ —Å –º–æ–±–∏–ª—å–Ω–∏–∫–∞.
```python
from fake_useragent import UserAgent

ua = UserAgent()
print(ua.random)
# ‚Üí Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/...
```

–ò—Ç–æ–≥–æ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –º—ã —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ requirements.txt:
```txt
requests>=2.31.0
beautifulsoup4>=4.12.3
lxml>=4.9.3
fake-useragent>=1.5.1
```
–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —á–µ—Ä–µ–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª:
```bash
pip install -r requirements.txt
```


##                      üì¶ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ `cian_parser/` 

| –ú–æ–¥—É–ª—å            | –ö–ª–∞—Å—Å / –ª–æ–≥–∏–∫–∞                | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å                          |
|------------------|-------------------------------|-------------------------------------------|
| `main.py`         | `Parser.run()`                | –ó–∞–ø—É—Å–∫ –≤—Å–µ–π —Ü–µ–ø–æ—á–∫–∏                      |
| `parser.py`       | `Parser`                      | –û—Ä–≥–∞–Ω–∏–∑—É–µ—Ç –≤—ã–∑–æ–≤: loader ‚Üí parser ‚Üí pipeline |
| `html_loader.py`  | `HtmlLoader`                  | –î–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å —Å fake-useragent / –ø—Ä–æ–∫—Å–∏  |
| `cian_parser.py`  | `CianParser`                  | –†–∞–∑–±–∏—Ä–∞–µ—Ç HTML ‚Üí list[dict]              |
| `pipeline.py`     | `DataPipeline`                | –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ CSV (–∏–ª–∏ Excel/DB –ø–æ—Ç–æ–º)     |
| `proxy.py`        | `ProxyManager` *(–æ–ø—Ü.)*       | –í—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–æ–∫—Å–∏, —Ä–æ—Ç–∞—Ü–∏—è                |
| `utils.py`        | `clean_text()`, `slugify()`   | –û—á–∏—Å—Ç–∫–∞ —Å—Ç—Ä–æ–∫, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è              |
| `settings.py`     | `HEADERS`, `TIMEOUT`, `CSV_PATH` | –ö–æ–Ω—Ñ–∏–≥–∏, –Ω–µ —Ö–∞—Ä–¥–∫–æ–¥–∏–º –≤ –∫–æ–¥–µ          |
| `data/output.csv` | ‚Äî                             | –ì–æ—Ç–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç                         |

## üì¶ –ö–ª–∞—Å—Å Parser

–ö–ª–∞—Å—Å Parser ‚Äî —ç—Ç–æ –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É—é—â–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø—Ä–æ–µ–∫—Ç–∞. –û–Ω –æ—Ä–≥–∞–Ω–∏–∑—É–µ—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –ø–∞—Ä—Å–∏–Ω–≥–∞: –æ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ HTML –¥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ CSV.

### üîß –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
	‚Ä¢	–ü–æ–ª—É—á–∞–µ—Ç HTML-–∫–æ–¥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å –¶–ò–ê–ù –ø–æ –∑–∞–¥–∞–Ω–Ω–æ–º—É URL
	‚Ä¢	–ü–µ—Ä–µ–¥–∞—ë—Ç HTML –≤ CianParser, –∫–æ—Ç–æ—Ä—ã–π –∏–∑–≤–ª–µ–∫–∞–µ—Ç –Ω—É–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–≥–æ–ª–æ–≤–æ–∫, —Ü–µ–Ω—É, —Å—Å—ã–ª–∫—É)
	‚Ä¢	–ü–µ—Ä–µ–¥–∞—ë—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ DataPipeline –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ —Ñ–∞–π–ª (output_–ì–ì–ì–ì-–ú–ú-–î–î.csv)
	‚Ä¢	–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∑–∞—â–∏—Ç—É –æ—Ç –±–∞–Ω–æ–≤ (–ø–∞—É–∑–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏, —Å–ª—É—á–∞–π–Ω—ã–π User-Agent)
	‚Ä¢	–†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –µ–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –∑–∞–ø—É—Å–∫–∞: Parser(url).run()

### üß© –ò—Å–ø–æ–ª—å–∑—É–µ—Ç:
	‚Ä¢	HtmlLoader ‚Äî –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
	‚Ä¢	CianParser ‚Äî –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ä–∞–∑–±–æ—Ä HTML –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
	‚Ä¢	DataPipeline ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ CSV
```python
class Parser:
    def __init__(self, url=BASE_URL):
        self.url = url
        self.loader = HtmlLoader(url)
        self.parser = CianParser()
        self.pipeline = DataPipeline()
```
### üöÄ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
```python
from cian_parser.parser import Parser

parser = Parser()
parser.run()
```


## üåê –ö–ª–∞—Å—Å HtmlLoader ‚Äî –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–æ–º JS

–ö–ª–∞—Å—Å HtmlLoader –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ HTML-–∫–æ–¥–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å –¶–ò–ê–ù, –≤–∫–ª—é—á–∞—è –≤—Å–µ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–¥–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Å –ø–æ–º–æ—â—å—é JavaScript (—Ç–∞–∫–∏–µ –∫–∞–∫ —Ü–µ–Ω–∞, –∞–¥—Ä–µ—Å, –º–µ—Ç—Ä–æ –∏ —Ç.–¥.).

### üöÄ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

–í–º–µ—Å—Ç–æ –æ–±—ã—á–Ω–æ–≥–æ requests, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–Ω—ã–π –¥–≤–∏–∂–æ–∫ Playwright, –∫–æ—Ç–æ—Ä—ã–π:
	‚Ä¢	–∑–∞–ø—É—Å–∫–∞–µ—Ç Chromium –≤ headless-—Ä–µ–∂–∏–º–µ
	‚Ä¢	–ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É URL
	‚Ä¢	–¥–æ–∂–∏–¥–∞–µ—Ç—Å—è –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–≤–∫–ª—é—á–∞—è JS)
	‚Ä¢	–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π HTML, –∫–∞–∫ –µ—Å–ª–∏ –±—ã –µ–≥–æ —É–≤–∏–¥–µ–ª –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

### üîß –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
	‚Ä¢	–í—ã–ø–æ–ª–Ω—è–µ—Ç HTTP-–∑–∞–ø—Ä–æ—Å —Å –ø–æ–º–æ—â—å—é requests
	‚Ä¢	–ü–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–π User-Agent (—á–µ—Ä–µ–∑ fake-useragent)
	‚Ä¢	–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏ (http –∏ https)
	‚Ä¢	–î–µ–ª–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—É—é –ø–∞—É–∑—É (1.5‚Äì3.0 —Å–µ–∫) –ø–æ—Å–ª–µ –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
	‚Ä¢	–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—É—é HEAD-–ø—Ä–æ–≤–µ—Ä–∫—É URL –Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
	‚Ä¢	–õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ —Å–æ–±—ã—Ç–∏—è –≤ —Ñ–∞–π–ª loader.log (—É—Å–ø–µ—à–Ω—ã–µ –∏ –æ—à–∏–±–æ—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã)

üì¶ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
```python
from parser_engine.html_loader import HtmlLoader

url = "https://www.cian.ru/sale/flat/315400445/"
loader = HtmlLoader(url)
html = loader.fetch()

# html —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π DOM
```
üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:
	1.	–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω playwright:
```bash
pip install -r requirements.txt
playwright install
```
	2.	–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: playwright install –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ–¥–∏–Ω —Ä–∞–∑, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –±—Ä–∞—É–∑–µ—Ä—ã.


### üîç –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –º–µ—Ç–æ–¥ fetch() –≤–Ω—É—Ç—Ä–∏ HtmlLoader

üî¢ –®–∞–≥ –∑–∞ —à–∞–≥–æ–º:
1.	–ó–∞–ø—É—Å–∫ –±—Ä–∞—É–∑–µ—Ä–∞ Chromium –≤ —Ñ–æ–Ω–µ
```python
browser = p.chromium.launch(headless=True)
```
	‚Ä¢	–û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –Ω–µ–≤–∏–¥–∏–º–æ–µ (headless) –æ–∫–Ω–æ –±—Ä–∞—É–∑–µ—Ä–∞
	‚Ä¢	–≠—Ç–æ –¥–∞—ë—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–≥—Ä—É–∑–∏—Ç—å JS, –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞—è —Ä–µ–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ

2.	–°–æ–∑–¥–∞–Ω–∏–µ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
```python
context = browser.new_context()
```
    ‚Ä¢	–°–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤–∞—è ‚Äú—Å–µ—Å—Å–∏—è –±—Ä–∞—É–∑–µ—Ä–∞‚Äù ‚Äî —Å–æ —Å–≤–æ–∏–º–∏ –∫—É–∫–∞–º–∏, –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ–º
	‚Ä¢	–ú–æ–∂–Ω–æ –ø–æ–¥–º–µ–Ω—è—Ç—å UA, –≤—ã—Å—Ç–∞–≤–ª—è—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é –∏ —Ç.–¥. (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

3.	–û—Ç–∫—Ä—ã—Ç–∏–µ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–∏
```python
page = context.new_page()
```

4.	–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π URL
```python
page.goto(self.url)
```
	‚Ä¢	Playwright –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É, –≤–∫–ª—é—á–∞—è –≤—Å–µ JS-—Ä–µ—Å—É—Ä—Å—ã
	‚Ä¢	–û–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∂–¥—ë—Ç –æ–∫–æ–Ω—á–∞–Ω–∏—è DOMContentLoaded, –Ω–æ –º—ã –¥–æ–±–∞–≤–∏–º –ø–∞—É–∑—É –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏

5.	–û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–π –ø–æ–¥–≥—Ä—É–∑–∫–∏ JS-–∫–æ–Ω—Ç–µ–Ω—Ç–∞
```python
time.sleep(random.uniform(2.5, 4.0))
```
    ‚Ä¢	–≠—Ç–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–∞—ë—Ç –±—Ä–∞—É–∑–µ—Ä—É –≤—Ä–µ–º—è ‚Äú–¥–æ—Ç—è–Ω—É—Ç—å‚Äù –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ (—Ü–µ–Ω–∞, –∞–¥—Ä–µ—Å, –º–µ—Ç—Ä–æ)
	‚Ä¢	–ü–æ—Ç–æ–º –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –±–æ–ª–µ–µ —É–º–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, page.wait_for_selector)

6.	–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ DOM
```python
html = page.content()
```
	‚Ä¢	–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è HTML-–∫–æ–¥ –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫–∏ ‚Äî –æ–Ω —É–∂–µ –≤–∫–ª—é—á–∞–µ—Ç –≤—Å—ë, —á—Ç–æ ‚Äú–æ—Ç—Ä–∏—Å–æ–≤–∞–ª‚Äù JS
	‚Ä¢	–≠—Ç–æ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –∫–æ–ø–∏—è –∫–æ–¥–∞, –∫–∞–∫ –µ–≥–æ —É–≤–∏–¥–µ–ª –±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

7.	–ó–∞–∫—Ä—ã—Ç–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞
```python
browser.close()
```

### üìå –ò—Ç–æ–≥–æ

fetch() –¥–µ–ª–∞–µ—Ç —Ç–æ, —á—Ç–æ –Ω–µ –º–æ–∂–µ—Ç requests:
–æ–Ω —ç–º—É–ª–∏—Ä—É–µ—Ç –∂–∏–≤–æ–π –±—Ä–∞—É–∑–µ—Ä, –ø—Ä–æ–≥—Ä—É–∂–∞–µ—Ç –≤–µ—Å—å –∫–æ–Ω—Ç–µ–Ω—Ç, –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∞–ª—å–Ω–æ ‚Äú–∂–∏–≤–æ–π‚Äù HTML, –ø—Ä–∏–≥–æ–¥–Ω—ã–π –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞.


